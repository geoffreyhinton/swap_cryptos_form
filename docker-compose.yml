services:
  geth:
    build: .
    container_name: geth-testnet
    ports:
      - "8545:8545"   # HTTP-RPC
      - "8546:8546"   # WS-RPC
      - "30303:30303" # P2P
      - "6060:6060"   # Metrics
    volumes:
      - geth_data:/app/data
      - ./genesis.json:/app/genesis.json
      - ./scripts:/app/scripts
      - ./keystore:/app/keystore
    environment:
      - NETWORK_ID=${NETWORK_ID:-1337}
      - CHAIN_ID=${CHAIN_ID:-1337}
      - HTTP_PORT=${HTTP_PORT:-8545}
      - WS_PORT=${WS_PORT:-8546}
      - P2P_PORT=${P2P_PORT:-30303}
      - MINING=${MINING:-true}
      - MINER_THREADS=${MINER_THREADS:-1}
    restart: unless-stopped
    networks:
      - geth-network

  # Custom Ethereum Block Explorer
  explorer:
    image: nginx:alpine
    container_name: eth-explorer
    ports:
      - "4000:80"
    volumes:
      - ./explorer.html:/usr/share/nginx/html/index.html:ro
    depends_on:
      - geth
    networks:
      - geth-network
    restart: unless-stopped

volumes:
  geth_data:

networks:
  geth-network:
    driver: bridge